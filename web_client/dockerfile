# Oil Database Web Client Docker configuration
#
FROM registry.orr.noaa.gov/erd/centos-conda/centos7-python3.9

RUN echo "ip_resolve=4" >> /etc/yum.conf

RUN yum -y update

# 01/19/2022: So apparently the way Node gets installed on CentOS has changed
#             Pretty dramatically.
#             This is just so we can even see any node distribution at all,
#             and we can't simply refer to latest, we need to choose a version.
RUN curl -sL https://rpm.nodesource.com/setup_14.x | bash -
RUN yum -y install gcc-c++ make

RUN yum -y install nodejs

# node + npm are both installed at latest version for the distro, so we don't
# need to explicitly install npm.
#RUN yum -y install npm

COPY ./web_client/ /web_client/
COPY ./oildb-deploy/config/stage/web_client/ /web_client/public/configs/

RUN cd /web_client && npm install -g n
RUN cd /web_client && n 18
RUN cd /web_client && node --version

RUN cd /web_client && npm install npm@latest -g
RUN cd /web_client && npm install
RUN cd /web_client && npm --version

RUN cd /web_client && npm install -g ember-cli

EXPOSE 4200
ENTRYPOINT ["/web_client/docker_start.sh"]
